* BibTeX
#+CINDEX: BibTeX
#+CINDEX: bibtex
#+VINDEX: casual-bibtex-tmenu

Casual BibTeX is an opinionated user interface for BibTeX mode ([[info:emacs#TeX Mode][info "(emacs) TeX Mode"]]), a major mode for working with BibTeX files ([[https://bibtex.eu][BibTeX Guide]]).

A BibTeX file is typically named using the suffix ~.bib~ to identify its file type.

To appreciate the benefits of Casual BibTeX, it helps to understand what BibTex is and what BibTeX mode offers.

BibTeX is a database schema for bibliography data. This data is best understood as a collection of records (or entries) that is stored in a plain-text file. Multiple text files can be supported. While most tooling for BibTeX is tuned for LaTeX documentation workflows, BibTeX can be used as generalized storage for bibliography data. Org provides extensive support for citing using BibTeX ([[info:org#Citation handling][info "(org) Citation handling"]]).

As a BibTeX file is plain-text based, any plain-text editor can be used to edit it. This flexibility is problematic as plain-text editors will not enforce the schema of BibTeX by default.

Emacs distinguishes itself from other editors in that support for working with BibTeX files is built-in with the package ~bibtex~.

The ~bibtex~ package provides commands for both navigating and editing BibTeX data structures (entries and the fields within an entry) in a quasi-"form-based" way.

Casual BibTeX organizes and augments BibTeX mode commands into a keyboard-driven menu.

The screenshot below shows the menu for Casual BibTeX.

[[file:images/casual-bibtex-screenshot.png]]

** BibTeX Install
:PROPERTIES:
:CUSTOM_ID: bibtex-install
:END:

#+CINDEX: BibTeX Install

In your initialization file, bind the Transient ~casual-bibtex-tmenu~ to your key binding of preference in ~bibtex-mode-map~. The binding {{{kbd(M-m)}}} is suggested so as to not conflict with {{{kbd(C-o)}}} that is bound to ~casual-editkit-main-tmenu~. ([[#editkit-install][EditKit Install]])

#+begin_src elisp :lexical no
  (keymap-set bibtex-mode-map "M-m" #'casual-bibtex-tmenu)
#+end_src

~casual-bibtex-tmenu~ is opinionated in making editing and navigation commands emulate a form-based interface ([[https://simple.wikipedia.org/wiki/Form-based_interface#:~:text=A%20form%2Dbased%20interface%20is,the%20fields%20that%20accept%20it.][form-based interface]]) in a ~bibtex-mode~ window. The following keybindings are recommended to support consistent behavior between ~bibtex-mode-map~ and ~casual-bibtex-tmenu~.

#+begin_src elisp :lexical no
  (add-hook 'bibtex-mode-hook 'hl-line-mode)

  (keymap-set bibtex-mode-map "<TAB>" #'bibtex-next-field)
  (keymap-set bibtex-mode-map "<backtab>" #'previous-line)

  (keymap-set bibtex-mode-map "C-n" #'bibtex-next-field)
  (keymap-set bibtex-mode-map "M-n" #'bibtex-next-entry)
  (keymap-set bibtex-mode-map "M-p" #'bibtex-previous-entry)

  (keymap-set bibtex-mode-map "<prior>" #'bibtex-previous-entry)
  (keymap-set bibtex-mode-map "<next>" #'bibtex-next-entry)

  (keymap-set bibtex-mode-map "C-c C-o" #'bibtex-url)
  (keymap-set bibtex-mode-map "C-c C-c" #'casual-bibtex-fill-and-clean)

  (keymap-set bibtex-mode-map "<clear>" #'bibtex-empty-field)
  (keymap-set bibtex-mode-map "M-<clear>" #'bibtex-kill-field)
  (keymap-set bibtex-mode-map "M-DEL" #'bibtex-kill-field)

#+end_src

** BibTeX Usage
#+CINDEX: BibTeX Usage

[[file:images/casual-bibtex-screenshot.png]]

The main menu for Casual BibTeX is organized into the following sections:

- Field :: Commands to edit or navigate fields within an entry.
- Entry :: Commands to edit or navigate entries within a BibTeX file.
- Misc :: Miscellaneous BibTeX commands.

*** BibTeX Navigation
#+CINDEX: BibTeX Navigation

[[file:images/casual-bibtex-screenshot.png]]

Casual BibTeX re-purposes conventional Emacs navigation bindings so that instead of navigating a text edit buffer, it instead navigates BibTeX structures (entry, field).

The following table shows the bindings for BibTeX navigation.

| Binding        | Command                                           |
|----------------+---------------------------------------------------|
| {{{kbd(C-n)}}} | bibtex-next-field (bound to {{{kbd(n)}}} in menu) |
| {{{kbd(C-p)}}} | previous-line (bound to {{{kbd(p)}}} in menu)     |
| {{{kbd(C-a)}}} | casual-bibtex-beginning-of-field                  |
| {{{kbd(C-e)}}} | casual-bibtex-end-of-field                        |
| {{{kbd(M-p)}}} | bibtex-previous-entry                             |
| {{{kbd(M-n)}}} | bibtex-next-entry                                 |
| {{{kbd(<)}}}   | bibtex-beginning-of-entry                         |
| {{{kbd(>)}}}   | bibtex-end-of-entry                               |

*** Creating, Updating, and Deleting BibTeX Structures
#+CINDEX: BibTeX CRUD

[[file:images/casual-bibtex-screenshot.png]]

In Casual BibTeX, CRUD (CReate, Update, Delete) operations for entry and field structures are intended to be achieved through their respective commands. This contrasts with manual editing of a buffer to achieve the same end, which is prone to errors.

#+TEXINFO: @subheading Creating an Entry

To create a new entry, use the “{{{kbd(A)}}} Add…” command. You will be prompted in the mini-buffer with completion support for the entry type. This new entry will be inserted relative to existing entry where the point is with all fields supported by the entry type enumerated.  Fields with the temporary prefix of "ALT" or "OPT" denote a field that is alternate or optional. Use the command “{{{kbd(o)}}} Remove OPT/ALT” to remove this prefix. 

When all desired information for a BibTeX entry has been entered, it can be "cleaned" using the command “{{{kbd(C-c)}}} Clean”. Cleaning an entry will:

1. Generate a unique citation key, if needed.
2. Remove all unused fields.

By default, cleaning an entry will not format (or "fill") the entry. This can be changed by setting the customizable variable ~bibtex-clean-entry-hook~ to include the command ~bibtex-fill-entry~. This can be done from "Hooks" section in the Settings menu ([[#bibtex-settings][Settings)]]. 

#+TEXINFO: @subheading Creating a Field

To create a new field, use the “{{{kbd(a)}}} Add…” command. You will be prompted in the mini-buffer with completion support for the field type. This new field will be inserted relative to existing field where the point is.

There are two components to a field:

- key :: the field name, referred to in the menu as 'k'.
- value ::  the value of the field, referred to in the menu as 'v'.

A "brute-force" command to enumerate all fields for an entry is provided by the “{{{kbd(u)}}} Update…” command. Clean the entry to remove all unpopulated fields after using it.
  
#+TEXINFO: @subheading BibTeX mode has its own kill-ring

BibTeX has its own kill-ring variable ~bibtex-entry-kill-ring~ which the following menu commands use:

- {{{kbd(c)}}} Copy∙ k,v :: Copy the whole field, both key and value.
- {{{kbd(C)}}} Copy∙ :: Copy the entry.
- {{{kbd(k)}}} Kill∙ :: Kill the entry.
- {{{kbd(y)}}} Yank∙ :: Yank the entry or field.
- {{{kbd(M-y)}}} Yank-Pop∙ :: Yank-pop the entry or field.
  
The "∙" annotation in a menu label denotes commands that do /not/ use the ~kill-ring~, but ~bibtex-entry-kill-ring~ instead.

#+TEXINFO: @subheading Search and Jump

The ability to search and jump to a position in a BibTeX database are offered by the following menu commands:

- {{{kbd(/)}}} Search… :: Search the BibTeX database.
- {{{kbd(j)}}} Jump… :: Move point to a citation key.

*** BibTeX Settings
:PROPERTIES:
:CUSTOM_ID: bibtex-settings
:END:
#+CINDEX: BibTeX Settings

[[file:images/casual-bibtex-settings-screenshot.png]]


This menu offers access to commonly configured BibTeX mode settings.

Settings are organized into the following sections:

- Settings :: Miscellaneous BibTeX settings.
- Files :: File and path related settings.
- Search :: Search settings.
- Hooks :: Hook settings for cleaning and adding.

#+TEXINFO: @subsubheading BibTeX Clean Hook

By default BibTeX mode does not format (or "fill") an entry upon cleaning. To support filling an entry upon clean, add the command ~bibtex-fill-entry~ to ~bibtex-clean-entry-hook~ using the “{{{kbd(C)}}} Clean” command as shown below:

[[file:images/casual-bibtex-clean-entry-hook.png]]

#+TEXINFO: @subsubheading BibTeX Mode Unicode Symbol Support

By enabling “{{{kbd(u)}}} Use Unicode Symbols” from the Settings menu, Casual BibTeX will use Unicode symbols as appropriate in its menus.

[[file:images/casual-bibtex-unicode-screenshot.png]]
